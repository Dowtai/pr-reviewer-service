# PR Reviewer Service
Backend-trainee-assignment-autumn-2025 in Avito.

---

## Требования

- Go **1.25+**
- Docker **24+**
- Docker Compose **v2+**

---

# Установка и запуск

Сам сервис работает на порте, указанном в `.env` (default: `8080`). 

Тесты всегда запускаются на `8080`.

## 1. Запуск локально (без Docker, Windows)

```bash
go mod download
go build -o pr-reviewer-service.exe ./main
.\pr-reviewer-service.exe
```

По умолчанию сервис поднимается на: http://localhost:8080

## 2. Запуск в Docker

Сборка и запуск выполняются одной командой:

```bash
docker-compose up --build
```
После этого сервис доступен по адресу: http://localhost:8080

## 3. Запуск тестов
(Docker должен быть выключен)

```bash
go test ./...
```


---

## Вопросы и проблемы

Я сделал in-memory реализацию, но разделил сервис на 3 слоя, 1 из которых - собственно in-memory реализация. 
Достаточно реализовать этот интерфейс с использование db, чтобы перенести сервис на базу данных.
уровень бизнес логики и api не полагаются на способ хранения данных.

Были добавлены кастомные ошибки, не прописанные в api: `INTERNAL_ERROR` и `FATAL_ERROR`.
У них 1 основной смысл - показать что произошла ошибка, связанная (с текущей реализацией) с нарушением инварианта того,
какие данные сейчас есть в сервисе.

Там, где в `openapi.yml` не хватало ошибок вида `NOT_FOUND`, они всё равно были написаны в сервисе.
(Например: в `GetReview` не было ошибки на случай, если запрашивают список PR пользователя, которого нет)

Получилась немного спутанная система ошибок именно на уровне реализацию внутри (это не касается уровня api):
получилось 2 типа ошибок, похожих друг на друга, в основном они затрагивают моменты, не связанные с бизнес логикой.
Сделаны они были с расчётом на простоту расширения сервиса или его переход на другой способ хранения данных.

Также в тз не было например сказано, что делать если создаётся команда с уже существующим `user_id` - 
решение: выкидывать ошибку. Почему? У user'а есть teamName, и он собственно только 1. Просто забыть о прошлой команде -
не вариант. Поэтому в целом  выбора: кидать ошибку или позволить человеку состоять в нескольких командах.
Второе - противоречило бы api, так что мною был выбран первый вариант.

Если что-то забыл описать - везде, где в api не было оговорено конкретное решение возможной ситуации - 
выбор делался аналогично выше описанному.

Также кажется, что текущая реализация не требует наличия Health, хотя возможно это и ошибка.